// Copyright 2018 Google LLC. All Rights Reserved. This file and proprietary
// source code may only be used and distributed under the Widevine Master
// License Agreement.

#ifndef WV_OEMCRYPTO_TYPES_H_
#define WV_OEMCRYPTO_TYPES_H_

#include <stdint.h>

namespace wvoec {

// This is the format of a Widevine keybox.
typedef struct WidevineKeybox {   // 128 bytes total.
  // C character string identifying the device.  Null terminated.
  uint8_t device_id_[32];
  // 128 bit AES key assigned to device.  Generated by Widevine.
  uint8_t device_key_[16];
  // Key Data.  Encrypted data.
  uint8_t data_[72];
  // Constant code used to recognize a valid keybox "kbox" = 0x6b626f78.
  uint8_t magic_[4];
  // The CRC checksum of the first 124 bytes of the keybox.
  uint8_t crc_[4];
} WidevineKeybox;

// Key Control Block Bit Masks:
const uint32_t kControlObserveDataPath = (1<<31);
const uint32_t kControlObserveHDCP     = (1<<30);
const uint32_t kControlObserveCGMS     = (1<<29);
const uint32_t kControlRequireAntiRollbackHardware = (1<<28);
const uint32_t kControlAllowHashVerification = (1<<24);
const uint32_t kSharedLicense          = (1<<23);
const uint32_t kControlSRMVersionRequired = (1<<22);
const uint32_t kControlDisableAnalogOutput = (1<<21);
const uint32_t kControlSecurityPatchLevelShift = 15;
const uint32_t kControlSecurityPatchLevelMask =
    (0x3F<<kControlSecurityPatchLevelShift);
const uint32_t kControlReplayMask      = (0x03<<13);
const uint32_t kControlNonceRequired   = (0x01<<13);
const uint32_t kControlNonceOrEntry    = (0x02<<13);
const uint32_t kControlHDCPVersionShift = 9;
const uint32_t kControlHDCPVersionMask = (0x0F<<kControlHDCPVersionShift);
const uint32_t kControlAllowEncrypt    = (1<<8);
const uint32_t kControlAllowDecrypt    = (1<<7);
const uint32_t kControlAllowSign       = (1<<6);
const uint32_t kControlAllowVerify     = (1<<5);
const uint32_t kControlDataPathSecure  = (1<<4);
const uint32_t kControlNonceEnabled    = (1<<3);
const uint32_t kControlHDCPRequired    = (1<<2);
const uint32_t kControlCGMSMask        = (0x03);
const uint32_t kControlCGMSCopyFreely  = (0x00);
const uint32_t kControlCGMSCopyOnce    = (0x02);
const uint32_t kControlCGMSCopyNever   = (0x03);

// Various constants and sizes:
static const size_t KEY_CONTROL_SIZE = 16;
static const size_t KEY_ID_SIZE = 16;
static const size_t KEY_IV_SIZE = 16;
static const size_t KEY_PAD_SIZE = 16;
static const size_t KEY_SIZE = 16;
static const size_t MAC_KEY_SIZE = 32;
static const size_t KEYBOX_KEY_DATA_SIZE = 72;
static const size_t SRM_REQUIREMENT_SIZE = 12;


}  // namespace wvoec

#endif  // WV_OEMCRYPTO_TYPES_H_
